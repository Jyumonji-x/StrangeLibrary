## 王海伟 lab4实验总结

### 1、负责任务

（1）微服务框架搭建

（2）后端罚金功能以及预约超时检查

（3）代码质量优化

### 2、微服务框架

  我们原本做好服务拆分的框架设计之后就打算开始先去拆分原本的服务。

  首先是参考了`eureka-example`，但是在尝试过程中虽然server可以成功启动，但是provider总是无法启动，或者启动之后无法访问到里面的服务，然后又参考了`spring-cloud-demo`,同样也是有一个服务无法启动，虽然修改代码之后可以正常启动了，但是服务之间的数据通讯依旧是出现问题，往往是拿不到需要的数据的。相关docker框架的设计也就无法继续。

  所以到最后决定先暂时放弃微服务的框架，完成要求实现的功能。

### 3、后端罚金功能以及预约超时检查

两者的思路大致是相同的，通过新建相关的库表来记录相关的数据，然后在需要的时候把记录放到存放所有记录的表当中。

罚金的计算和产生是发生在用户还书的操作上，需要前端向后端多发送一个书本状态的数据，来判断是完好，遗失，或者损坏，然后根据不同的情况来计算和产生罚金，并进入记录罚金的表单，然后更新副本状态为在库，损坏，或者遗失，随后把需要的记录存放在记录的数据库中。当用户付清罚金之后记录会被删除，同时也会更具是否有现存的罚金记录来限制用户的预约和借书。

预约超时检查发生在书本浏览页面的请求接口当中，回去获取所有的预约记录，并通过记录的有效时间来计算当前预约是否过期，如果过期则在记录过期的表中增加一条记录，在这里取消用户的预约，把副本状态调整为在库，并生成记录放在数据库中。当管理员向用户发送邮件提醒的时候或者用户主动确认，这条预约过期的记录会被删除，但是保留记录。

### 4、后续的准备

准备实现一个微服务框架然后拆分，要在下一个lab中利用spring-cloud实现微服务的框架，以及搭建好docker的自动化部署和相关的自动化编译脚本。同时处理好服务之间的解耦，便于服务拆分。



