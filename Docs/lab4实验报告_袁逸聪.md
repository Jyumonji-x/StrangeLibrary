# SE2021 Lab4个人文档

19302010020 袁逸聪

## 工作内容

1. 新增功能架构设计
2. 所有新增的单元测试
3. 微服务框架尝试
4. 后端除罚金、预约超时检查外所有新增业务的实现
5. 构架改动下旧有业务及单元测试的所有重构工作

## 新增功能架构设计

Lab4中数据表架构发生较大变化：

原本借阅被当做一个流程对待：生于预约或直接借书，止于归还，最后所有借阅条目都将停止在“归还”状态。这与系统记录是相悖的，因为预约和借出的记录终将被覆盖。

因而我们拓展了副本表，更充分的信息能够表达出副本当下的状态，与一本真实书目的语义相符合。而原本的预约表则被改造成了系统记录表，保留了其原有的信息丰富全面之特点，但不再参与业务逻辑，仅做历史记录之用。

新增功能也需要一些设计来实现，譬如新增的罚金表和逾期预约表，实际上相当于两个消息栈。当罚金产生或检测到预约过期的时候就往表中添加消息，直到改消息得到了需要的处理再将其清除。

## 单元测试

之前的单元测试往往只追求方法覆盖率，但对各种情况考虑得较少

本次新增的单元测试多考虑了些不同情况的测试，以求提高代码覆盖率(即让测试用例能够触发尽可能多的代码，确保写下的代码在运行是不会出问题)

但web中的单元测试仍是意见比较麻烦的事，包括在数据库中模拟数据的步骤较为繁琐、使用流程中靠后的方法很难独立快速测试等困难

## 微服务框架尝试

本次Lab原本进行了拆分出9个服务的设计，但实际执行中遇到很大困难：spring家族的配置错综复杂，当服务多起来就很难分辨哪些配置对哪些服务是必须的。同时我们所找到的微服务demo在运行时也会出现比较多的问题，包括无法挂起、或有时能挂起而有时就不行……

不过从尝试的经验中，我们初步掌握了docker-compose的用法

本次Lab将前端、后端、数据库拆分开部署在了3个docker容器中，以docker-compose启动。但后端内部更细的拆分还需要帮助